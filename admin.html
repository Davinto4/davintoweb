<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - DavintoWeb</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>
  <header class="topnav">
    <h1>DavintoWeb Admin Panel</h1>
    <nav>
      <button onclick="logout()">Logout</button>
    </nav>
  </header>  <main id="main-content" style="display:none">
    <section>
      <h2>Welcome, <span id="admin-name"></span></h2>
      <p>Email Verified: <span id="email-verified"></span></p>
      <button id="resend-verification">Resend Verification Email</button>
    </section><section>
  <h3>Post New Portfolio</h3>
  <form id="portfolio-form">
    <input type="text" placeholder="Title" id="title" required />
    <input type="text" placeholder="Image URL" id="image" required />
    <textarea placeholder="Description" id="description" required></textarea>
    <button type="submit">Post Project</button>
  </form>
</section>

<section>
  <h3>Portfolio Items</h3>
  <div id="portfolio-list"></div>
</section>

<section>
  <h3>Payment Confirmations</h3>
  <button onclick="exportCSV('payments')">Export Payments CSV</button>
  <div id="payment-list"></div>
</section>

  </main>  <section id="login-section">
    <h2>Admin Login</h2>
    <form id="login-form">
      <input type="email" id="login-email" placeholder="Email" required />
      <input type="password" id="login-password" placeholder="Password" required />
      <button type="submit">Login</button>
    </form>
  </section>  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBz7fdasuQLxIFLq2TJzPAQrDTJq6h_YT8",
      authDomain: "davintoweb-payments.firebaseapp.com",
      databaseURL: "https://davintoweb-payments-default-rtdb.firebaseio.com",
      projectId: "davintoweb-payments",
      storageBucket: "davintoweb-payments.appspot.com",
      messagingSenderId: "667742200333",
      appId: "1:667742200333:web:cf75f6cef6798eed432b44"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    auth.onAuthStateChanged(user => {
      if (user) {
        if (user.emailVerified) {
          document.getElementById("main-content").style.display = "block";
          document.getElementById("login-section").style.display = "none";
          document.getElementById("admin-name").textContent = user.email;
          document.getElementById("email-verified").textContent = "âœ…";
          loadPayments();
          loadPortfolio();
        } else {
          alert("Please verify your email before accessing admin dashboard.");
        }
      }
    });

    document.getElementById("resend-verification").onclick = () => {
      if (auth.currentUser) {
        auth.currentUser.sendEmailVerification().then(() => {
          alert("Verification email sent to " + auth.currentUser.email);
        });
      }
    };

    document.getElementById("login-form").addEventListener("submit", e => {
      e.preventDefault();
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;
      auth.signInWithEmailAndPassword(email, password)
        .then(userCredential => {
          location.reload();
        })
        .catch(error => alert("Login failed: " + error.message));
    });

    function logout() {
      auth.signOut().then(() => location.reload());
    }

    document.getElementById("portfolio-form").addEventListener("submit", e => {
      e.preventDefault();
      const title = document.getElementById("title").value;
      const image = document.getElementById("image").value;
      const description = document.getElementById("description").value;
      const newRef = db.ref("portfolio").push();
      newRef.set({ title, image, description });
    });

    function loadPortfolio() {
      db.ref("portfolio").on("value", snapshot => {
        const container = document.getElementById("portfolio-list");
        container.innerHTML = "";
        snapshot.forEach(child => {
          const { title, image, description } = child.val();
          const item = document.createElement("div");
          item.innerHTML = `
            <h4>${title}</h4>
            <img src="${image}" width="100" />
            <p>${description}</p>
            <button onclick="editPortfolio('${child.key}')">Edit</button>
            <button onclick="deletePortfolio('${child.key}')">Delete</button>
          `;
          container.appendChild(item);
        });
      });
    }

    function editPortfolio(id) {
      const newTitle = prompt("New title:");
      if (newTitle) db.ref(`portfolio/${id}/title`).set(newTitle);
    }

    function deletePortfolio(id) {
      db.ref(`portfolio/${id}`).remove();
    }

    function loadPayments() {
      db.ref("payments").on("value", snapshot => {
        const container = document.getElementById("payment-list");
        container.innerHTML = "";
        snapshot.forEach(child => {
          const data = child.val();
          const item = document.createElement("div");
          item.innerHTML = `
            <p><strong>${data.name}</strong> - ${data.email} - ${data.message}</p>
            <button onclick="deletePayment('${child.key}')">Delete</button>
          `;
          container.appendChild(item);
        });
      });
    }

    function deletePayment(id) {
      db.ref(`payments/${id}`).remove();
    }

    function exportCSV(type) {
      const ref = db.ref(type);
      ref.once("value", snapshot => {
        const data = [];
        snapshot.forEach(child => data.push(child.val()));
        const csv = Papa.unparse(data);
        const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `${type}.csv`;
        link.click();
      });
    }
  </script></body>
</html>